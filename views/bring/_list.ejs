<%
const data = bringlist.data;
const needed = data.needed || [];
const custom = data.custom || [];
const id = bringlist.id;
%>

<h2>Needed Items</h2>
<% if (needed.length === 0) { %>
  <p>No items needed yet.</p>
<% } else { %>
  <div class="bring-items">
    <% needed.forEach((item, idx) => {
      const totalClaimed = (item.claims || []).reduce((sum, c) => sum + c.amount, 0);
      const remaining = item.amount_needed - totalClaimed;
      const pct = Math.round((totalClaimed / item.amount_needed) * 100);
      const isComplete = remaining <= 0;
    %>
      <div class="bring-card <%= isComplete ? 'bring-card--complete' : '' %>">
        <div class="bring-card-header">
          <span class="bring-card-name"><%= item.item %></span>
          <% if (isComplete) { %>
            <span class="complete-badge">Complete</span>
          <% } else { %>
            <span class="bring-card-count"><%= totalClaimed %> of <%= item.amount_needed %></span>
          <% } %>
        </div>

        <div class="bring-progress">
          <div class="bring-progress-bar" style="width: <%= pct %>%"></div>
        </div>

        <% if (item.claims && item.claims.length > 0) { %>
          <div class="bring-claims">
            <% item.claims.forEach(c => { %>
              <span class="bring-claim-chip"><%= c.name %>: <%= c.amount %></span>
            <% }); %>
          </div>
        <% } else { %>
          <div class="bring-claims bring-claims--empty">No claims yet</div>
        <% } %>

        <% if (!isComplete) { %>
          <form hx-post="/b/<%= id %>/claim/<%= idx %>" hx-target="#bringlist-content" hx-swap="innerHTML" class="bring-claim-form">
            <input type="text" name="name" placeholder="Your name" required>
            <input type="number" name="amount" min="1" max="<%= remaining %>" value="1" required>
            <button type="submit">Claim</button>
          </form>
        <% } %>
      </div>
    <% }); %>
  </div>
<% } %>

<h2>Extras</h2>
<p class="hint">Bring something not on the list</p>

<form hx-post="/b/<%= id %>/custom" hx-target="#bringlist-content" hx-swap="innerHTML" class="bring-custom-form">
  <input type="text" name="name" placeholder="Your name" required>
  <input type="text" name="item" placeholder="Item" required>
  <input type="number" name="amount" min="1" value="1" required>
  <button type="submit">Add</button>
</form>

<% if (custom.length > 0) { %>
  <div class="bring-extras">
    <% custom.forEach(c => { %>
      <div class="bring-extra-chip">
        <strong><%= c.name %></strong> brings <%= c.item %><% if (c.amount > 1) { %> &times; <%= c.amount %><% } %>
      </div>
    <% }); %>
  </div>
<% } %>
